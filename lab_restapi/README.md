# REST API lab

## Реализованная функциональность

### 1. Базовые CRUD операции
- **GET /api/books** - получение списка всех книг
- **GET /api/books/{book_id}** - получение книги по ID
- **POST /api/books** - создание новой книги (требуется аутентификация)
- **PUT /api/books/{book_id}** - полное обновление книги (требуется аутентификация)
- **PATCH /api/books/{book_id}** - частичное обновление книги (требуется аутентификация)
- **DELETE /api/books/{book_id}** - удаление книги (требуется аутентификация)

### 2. Фильтрация и пагинация
- Фильтрация по автору (регистронезависимый поиск)
- Фильтрация по диапазону годов издания
- Пагинация результатов (параметры `skip` и `limit`)

### 3. Аутентификация
- API Key аутентификация через заголовок `X-API-Key`
- Защита операций создания, обновления и удаления

### 4. Статистика
- **GET /api/books/stats** - получение статистики по книгам:
  - Общее количество книг
  - Количество книг по авторам
  - Количество книг по векам

### 5. Валидация данных
- Валидация полей через Pydantic модели
- Проверка длины строковых полей
- Проверка диапазона года издания
- Валидация ISBN (опционально)

## Технологии

- **FastAPI** - современный веб-фреймворк для создания API
- **Pydantic** - валидация данных и сериализация
- **SQLAlchemy** - ORM для работы с базой данных
- **Uvicorn** - ASGI сервер для запуска приложения

## Установка и запуск

1. Создайте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate
```

2. Установите зависимости:
```bash
pip install fastapi uvicorn sqlalchemy pydantic
```

3. Настройте базу данных (создайте файлы `database.py` и `auth.py`):
   - `database.py` - настройка SQLAlchemy и модель `BookDB`
   - `auth.py` - функция `verify_api_key` для аутентификации

4. Запустите сервер:
```bash
python app.py
```

Или через uvicorn напрямую:
```bash
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

5. Откройте в браузере:
- API документация (Swagger): http://127.0.0.1:8000/docs
- Альтернативная документация (ReDoc): http://127.0.0.1:8000/redoc
- Корневой endpoint: http://127.0.0.1:8000/

## API Endpoints

### Корневой endpoint
- `GET /` - приветственное сообщение и ссылки на документацию

### Книги
- `GET /api/books` - список книг с фильтрацией и пагинацией
  - Параметры запроса:
    - `author` (optional) - фильтр по автору
    - `year_from` (optional) - минимальный год издания
    - `year_to` (optional) - максимальный год издания
    - `skip` (default: 0) - количество пропущенных записей
    - `limit` (default: 10) - максимальное количество записей
- `GET /api/books/{book_id}` - получение книги по ID
- `POST /api/books` - создание новой книги (требуется `X-API-Key`)
- `PUT /api/books/{book_id}` - полное обновление книги (требуется `X-API-Key`)
- `PATCH /api/books/{book_id}` - частичное обновление книги (требуется `X-API-Key`)
- `DELETE /api/books/{book_id}` - удаление книги (требуется `X-API-Key`)

### Статистика
- `GET /api/books/stats` - статистика по книгам

## Примеры использования

### Получение списка книг
```bash
curl http://127.0.0.1:8000/api/books
```

### Фильтрация по автору
```bash
curl "http://127.0.0.1:8000/api/books?author=Толстой"
```

### Фильтрация по году с пагинацией
```bash
curl "http://127.0.0.1:8000/api/books?year_from=1800&year_to=1900&skip=0&limit=5"
```

### Создание новой книги
```bash
curl -X POST "http://127.0.0.1:8000/api/books" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "title": "Война и мир",
    "author": "Лев Толстой",
    "year": 1869,
    "isbn": "9785170987654"
  }'
```

### Обновление книги
```bash
curl -X PUT "http://127.0.0.1:8000/api/books/1" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "title": "Война и мир",
    "author": "Лев Толстой",
    "year": 1869,
    "isbn": "9785170987654"
  }'
```

### Частичное обновление книги
```bash
curl -X PATCH "http://127.0.0.1:8000/api/books/1" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "year": 1870
  }'
```

### Удаление книги
```bash
curl -X DELETE "http://127.0.0.1:8000/api/books/1" \
  -H "X-API-Key: your-api-key"
```

### Получение статистики
```bash
curl http://127.0.0.1:8000/api/books/stats
```

## Модель данных

### Book (Книга)
- `id` (int) - уникальный идентификатор
- `title` (str) - название книги (1-200 символов)
- `author` (str) - автор книги (1-100 символов)
- `year` (int) - год издания (1000 - текущий год)
- `isbn` (str, optional) - ISBN книги (10-13 символов)

## Структура проекта

```
lab_restapi/
├── app.py              # Основной файл приложения FastAPI
├── database.py         # Настройка SQLAlchemy и модели БД (требуется создать)
├── auth.py             # Функции аутентификации (требуется создать)
└── README.md           # Документация проекта
```

## Примечания

- Для полноценной работы приложения необходимо создать модули `database.py` и `auth.py`
- `database.py` должен содержать настройку подключения к БД и модель `BookDB`
- `auth.py` должен содержать функцию `verify_api_key` для проверки API ключа
- По умолчанию сервер запускается на `http://0.0.0.0:8000`
- Автоматическая перезагрузка при изменении кода включена (`reload=True`)
